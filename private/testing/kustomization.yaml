---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: plc-testing
resources:
- ../../k8s/cloud/testing
patches:
# Patches that remove resources not used in cosmic testing cloud.
# These are largely related to supporting internal Ingress. In addition
# to moving pl-db-config management to terraform
- path: deletions/frontend_config.yaml
- path: deletions/cloud_ingress_managed_cert.yaml
- path: deletions/cloud_ingress_managed_cert_noslackin.yaml
- path: deletions/db_config.yaml
- path: domain_config.yaml
- path: proxy_envoy.yaml
- path: bq_config.yaml
- path: db_sidecar.yaml
  target:
    kind: Deployment
    labelSelector: db=pgsql
- path: internal_lb_service.yaml
  target:
    kind: Service
    name: cloud-proxy-service
- path: internal_lb_service.yaml
  target:
    kind: Service
    name: vzconn-service
- path: backend_config.yaml
  target:
    kind: BackendConfig
    name: cloud-proxy-backend-config
- path: backend_config.yaml
  target:
    kind: BackendConfig
    name: vzconn-backend-config
- path: cloud_ingress.yaml
  target:
    kind: Ingress
    name: cloud-ingress
# Not used in testing but is required for Internet facing environments.
# Testing environment relies on cert-manager for this certificate.
# - path: cloud_ingress_managed_certs.yaml
#   target:
#     kind: ManagedCertificate
#     name: cloud-ingress-managed-cert
# - path: cloud_ingress_managed_certs.yaml
#   target:
#     kind: ManagedCertificate
#     name: cloud-ingress-managed-cert-noslackin
